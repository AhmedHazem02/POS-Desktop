<UserControl x:Class="POS.CustomControl.SalesHistory_UserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d"
             MinWidth="900"
             MinHeight="600"
             FontFamily="Segoe UI"
             FlowDirection="RightToLeft"
             UseLayoutRounding="True"
             SnapsToDevicePixels="True">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>

        <!-- Modern Card Style (lighter + smaller padding for better density) -->
        <Style x:Key="ModernCard" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#E5E7EB" BlurRadius="12" ShadowDepth="1" Opacity="0.25"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern Search Box Style (smaller) -->
        <Style x:Key="ModernSearchBox" TargetType="TextBox">
            <Setter Property="Height" Value="40"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#111827"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Padding" Value="14,8"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="BorderThickness" Value="1.5"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10">
                            <ScrollViewer x:Name="PART_ContentHost"
                                          Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="#4F46E5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern Button Style (smaller + pressed) -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Height" Value="40"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#4F46E5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#4338CA"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#3730A3"/>
                                <Setter TargetName="Bd" Property="Opacity" Value="0.95"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Bd" Property="Opacity" Value="0.55"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Inputs style for ComboBox/DatePicker -->
        <Style x:Key="ModernPicker" TargetType="{x:Type Control}">
            <Setter Property="Height" Value="40"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>

        <!-- Stat Card Style (smaller) -->
        <Style x:Key="StatCard" TargetType="Border">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#667EEA" Offset="0"/>
                        <GradientStop Color="#764BA2" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="MinWidth" Value="220"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#CBD5E1" BlurRadius="16" ShadowDepth="1" Opacity="0.25"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- DataGrid row/cell sizing -->
        <Style x:Key="SalesGridRowStyle" TargetType="DataGridRow">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="#F3F4F6"/>
            <Style.Triggers>
                <Trigger Property="AlternationIndex" Value="1">
                    <Setter Property="Background" Value="#FAFAFA"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#EEF2FF"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#E0E7FF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SalesGridHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#F9FAFB"/>
            <Setter Property="Foreground" Value="#374151"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12.5"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="BorderThickness" Value="0,0,0,2"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="SalesGridCellStyle" TargetType="DataGridCell">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="12.5"/>
            <Setter Property="Foreground" Value="#4B5563"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="Transparent"/>
                </Trigger>
            </Style.Triggers>
        </Style>

    </UserControl.Resources>

    <!-- ScrollViewer makes the page responsive vertically on smaller heights -->
    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled"
                  Background="#F8FAFC">

        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header Section (wraps buttons if width is small) -->
            <Border Grid.Row="0" Style="{StaticResource ModernCard}" Margin="0,0,0,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="📊 فواتير المبيعات"
                                   FontSize="22"
                                   FontWeight="Bold"
                                   Foreground="#111827"/>
                        <TextBlock Text="إدارة وعرض جميع فواتير البيع"
                                   FontSize="12.5"
                                   Foreground="#6B7280"
                                   Margin="0,4,0,0"/>
                    </StackPanel>

                    <!-- Buttons area: WrapPanel makes it responsive -->
                    <WrapPanel Grid.Column="1"
                               Orientation="Horizontal"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Left">
                        <Button Content="📤 تصدير Excel"
                                Style="{StaticResource ModernButton}"
                                Background="#10B981"
                                Command="{Binding ExportCommand}"
                                Margin="0,0,10,0"/>
                        <Button Content="🔄 تحديث"
                                Style="{StaticResource ModernButton}"
                                Background="#6366F1"
                                Command="{Binding RefreshCommand}"/>
                    </WrapPanel>
                </Grid>
            </Border>

            <!-- Search & Filters Section -->
            <Border Grid.Row="1" Style="{StaticResource ModernCard}" Margin="0,0,0,10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                   <!-- Main Search (Responsive + icon on the right) -->
<Border Grid.Row="0"
        Margin="0,0,0,15"
        Background="White"
        CornerRadius="12"
        BorderThickness="1.5"
        Padding="4">

    <!-- Focus border -->
    <Border.Style>
        <Style TargetType="Border">
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Style.Triggers>
                <Trigger Property="IsKeyboardFocusWithin" Value="True">
                    <Setter Property="BorderBrush" Value="#4F46E5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Border.Style>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- Text area -->
        <Grid Grid.Column="0" Margin="6,0,8,0">
            <!-- Search icon (RIGHT) -->
            <materialDesign:PackIcon Kind="Magnify"
                                     Width="20"
                                     Height="20"
                                     Foreground="#9CA3AF"
                                     VerticalAlignment="Center"
                                     HorizontalAlignment="Right"
                                     Margin="0,0,10,0"/>

            <!-- TextBox -->
            <TextBox x:Name="InvoiceSearchBox"
                     Text="{Binding InvoiceSearchQuery, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay, Delay=200}"
                     Background="Transparent"
                     BorderThickness="0"
                     Height="36"
                     FontSize="14"
                     Foreground="#111827"
                     VerticalContentAlignment="Center"
                     TextAlignment="Right"
                     Padding="10,0,34,0"/>

            <!-- Placeholder -->
            <TextBlock Text="ابحث برقم الفاتورة..."
                       FontSize="13.5"
                       Foreground="#9CA3AF"
                       VerticalAlignment="Center"
                       HorizontalAlignment="Right"
                       Margin="0,0,34,0"
                       IsHitTestVisible="False">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Text, ElementName=InvoiceSearchBox}" Value="">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Text, ElementName=InvoiceSearchBox}" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
        </Grid>

        <!-- Search button -->
        <Button Grid.Column="1"
                Content="بحث"
                Height="36"
                MinWidth="92"
                Margin="0,0,6,0"
                VerticalAlignment="Center"
                Style="{StaticResource ModernButton}"
                Command="{Binding SearchCommand}"/>
    </Grid>
</Border>


                    <!-- Advanced Filters (responsive via WrapPanel) -->
                    <Expander Grid.Row="1"
                              Header="🎯 فلاتر متقدمة"
                              FontSize="13"
                              FontWeight="SemiBold"
                              Foreground="#4B5563"
                              IsExpanded="False">
                        <StackPanel Margin="0,12,0,0">

                            <!-- Date Range (wraps to next line) -->
                            <WrapPanel Orientation="Horizontal" ItemHeight="Auto">
                                <StackPanel Width="260" Margin="0,0,12,12">
                                    <TextBlock Text="📅 من تاريخ"
                                               FontSize="12.5"
                                               FontWeight="SemiBold"
                                               Foreground="#6B7280"
                                               Margin="0,0,0,6"/>
                                    <DatePicker SelectedDate="{Binding StartDate, Mode=TwoWay}"
                                                Style="{StaticResource ModernPicker}"
                                                BorderBrush="#E5E7EB"
                                                BorderThickness="1.5"/>
                                </StackPanel>

                                <StackPanel Width="260" Margin="0,0,12,12">
                                    <TextBlock Text="📅 إلى تاريخ"
                                               FontSize="12.5"
                                               FontWeight="SemiBold"
                                               Foreground="#6B7280"
                                               Margin="0,0,0,6"/>
                                    <DatePicker SelectedDate="{Binding EndDate, Mode=TwoWay}"
                                                Style="{StaticResource ModernPicker}"
                                                BorderBrush="#E5E7EB"
                                                BorderThickness="1.5"/>
                                </StackPanel>
                            </WrapPanel>

                            <!-- Other filters (wraps) -->
                            <WrapPanel Orientation="Horizontal">
                                <StackPanel Width="260" Margin="0,0,12,12">
                                    <TextBlock Text="🏪 المخزن"
                                               FontSize="12.5"
                                               FontWeight="SemiBold"
                                               Foreground="#6B7280"
                                               Margin="0,0,0,6"/>
                                    <ComboBox ItemsSource="{Binding Warehouses}"
                                              SelectedItem="{Binding SelectedWarehouse, Mode=TwoWay}"
                                              DisplayMemberPath="Name"
                                              Height="40"
                                              FontSize="13"
                                              BorderBrush="#E5E7EB"
                                              BorderThickness="1.5"/>
                                </StackPanel>

                                <StackPanel Width="260" Margin="0,0,12,12">
                                    <TextBlock Text="💳 طريقة الدفع"
                                               FontSize="12.5"
                                               FontWeight="SemiBold"
                                               Foreground="#6B7280"
                                               Margin="0,0,0,6"/>
                                    <ComboBox ItemsSource="{Binding PaymentMethods}"
                                              SelectedItem="{Binding SelectedPaymentMethod, Mode=TwoWay}"
                                              Height="40"
                                              FontSize="13"
                                              BorderBrush="#E5E7EB"
                                              BorderThickness="1.5"/>
                                </StackPanel>

                                <Button Content="🗑️ مسح الفلاتر"
                                        Style="{StaticResource ModernButton}"
                                        Background="#EF4444"
                                        Height="40"
                                        Margin="0,22,0,12"
                                        Command="{Binding ClearFiltersCommand}"/>
                            </WrapPanel>

                        </StackPanel>
                    </Expander>
                </Grid>
            </Border>

            <!-- Stats & Data Grid -->
            <Grid Grid.Row="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Statistics Cards (responsive wrap) -->
                <WrapPanel Grid.Row="0" Margin="0,0,0,10" ItemHeight="Auto">

                    <Border Style="{StaticResource StatCard}" Margin="0,0,10,10">
                        <StackPanel>
                            <TextBlock Text="📋" FontSize="26" Margin="0,0,0,8"/>
                            <TextBlock Text="إجمالي الفواتير"
                                       FontSize="12"
                                       Foreground="White"
                                       Opacity="0.9"
                                       Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding TotalInvoices, FallbackValue=0}"
                                       FontSize="22"
                                       FontWeight="Bold"
                                       Foreground="White"/>
                        </StackPanel>
                    </Border>

                    <Border Margin="0,0,10,10">
                        <Border.Style>
                            <Style TargetType="Border" BasedOn="{StaticResource StatCard}">
                                <Setter Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#F093FB" Offset="0"/>
                                            <GradientStop Color="#F5576C" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Border.Style>
                        <StackPanel>
                            <TextBlock Text="💰" FontSize="26" Margin="0,0,0,8"/>
                            <TextBlock Text="إجمالي المبيعات"
                                       FontSize="12"
                                       Foreground="White"
                                       Opacity="0.9"
                                       Margin="0,0,0,4"/>
                            <TextBlock FontSize="20" FontWeight="Bold" Foreground="White">
                                <Run Text="{Binding TotalAmount, StringFormat={}{0:N2}, FallbackValue=0.00}"/>
                                <Run Text=" جنيه" FontSize="13"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <Border Margin="0,0,10,10">
                        <Border.Style>
                            <Style TargetType="Border" BasedOn="{StaticResource StatCard}">
                                <Setter Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#4FACFE" Offset="0"/>
                                            <GradientStop Color="#00F2FE" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Border.Style>
                        <StackPanel>
                            <TextBlock Text="📊" FontSize="26" Margin="0,0,0,8"/>
                            <TextBlock Text="متوسط الفاتورة"
                                       FontSize="12"
                                       Foreground="White"
                                       Opacity="0.9"
                                       Margin="0,0,0,4"/>
                            <TextBlock FontSize="20" FontWeight="Bold" Foreground="White">
                                <Run Text="{Binding AverageInvoice, StringFormat={}{0:N2}, FallbackValue=0.00}"/>
                                <Run Text=" جنيه" FontSize="13"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <Border Margin="0,0,10,10">
                        <Border.Style>
                            <Style TargetType="Border" BasedOn="{StaticResource StatCard}">
                                <Setter Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#43E97B" Offset="0"/>
                                            <GradientStop Color="#38F9D7" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Border.Style>
                        <StackPanel>
                            <TextBlock Text="📦" FontSize="26" Margin="0,0,0,8"/>
                            <TextBlock Text="إجمالي الأصناف"
                                       FontSize="12"
                                       Foreground="White"
                                       Opacity="0.9"
                                       Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding TotalItems, FallbackValue=0}"
                                       FontSize="22"
                                       FontWeight="Bold"
                                       Foreground="White"/>
                        </StackPanel>
                    </Border>

                </WrapPanel>

                <!-- Data Grid Card -->
                <Border Grid.Row="1" Style="{StaticResource ModernCard}" Padding="0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Grid Header -->
                        <Border Grid.Row="0"
                                Background="#F9FAFB"
                                Padding="16,12"
                                BorderBrush="#E5E7EB"
                                BorderThickness="0,0,0,1">
                            <TextBlock Text="📝 قائمة الفواتير"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       Foreground="#374151"/>
                        </Border>

                        <Grid Grid.Row="1">
                            <!-- DataGrid -->
                            <DataGrid ItemsSource="{Binding InvoicesList}"
                                      SelectedItem="{Binding SelectedInvoice, Mode=TwoWay}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      CanUserDeleteRows="False"
                                      IsReadOnly="True"
                                      GridLinesVisibility="None"
                                      HeadersVisibility="Column"
                                      SelectionMode="Single"
                                      RowHeight="44"
                                      AlternationCount="2"
                                      BorderThickness="0"
                                      Background="White">
                                <DataGrid.Resources>
                                    <Style TargetType="DataGridRow" BasedOn="{StaticResource SalesGridRowStyle}"/>
                                    <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource SalesGridHeaderStyle}"/>
                                    <Style TargetType="DataGridCell" BasedOn="{StaticResource SalesGridCellStyle}"/>
                                </DataGrid.Resources>

                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="رقم الفاتورة"
                                                        Binding="{Binding Number}"
                                                        Width="140">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                                <Setter Property="Foreground" Value="#4F46E5"/>
                                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>

                                    <DataGridTextColumn Header="التاريخ"
                                                        Binding="{Binding Date, StringFormat='{}{0:yyyy/MM/dd}'}"
                                                        Width="120">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>

                                    <DataGridTextColumn Header="الكاشير"
                                                        Binding="{Binding CashierName}"
                                                        Width="*">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                                <Setter Property="Foreground" Value="#6366F1"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>

                                    <DataGridTemplateColumn Header="المبلغ الإجمالي" Width="160">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock FontWeight="Bold" Foreground="#059669" FontSize="13" HorizontalAlignment="Center">
                                                    <Run Text="{Binding TotalPrice, StringFormat={}{0:N2}}"/>
                                                    <Run Text=" جنيه" FontSize="11" Foreground="#6B7280"/>
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTemplateColumn Header="طريقة الدفع" Width="140">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Border Background="#E0F2FE"
                                                        CornerRadius="6"
                                                        Padding="8,4"
                                                        HorizontalAlignment="Center">
                                                    <TextBlock Text="{Binding PaymentMethod}"
                                                               FontSize="12"
                                                               FontWeight="SemiBold"
                                                               Foreground="#0284C7"
                                                               HorizontalAlignment="Center"/>
                                                </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                                    <DataGridTemplateColumn Header="الإجراءات" Width="200">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal"
                                                            HorizontalAlignment="Center"
                                                            VerticalAlignment="Center">
                                                    <Button Content="👁️ عرض"
                                                            Background="#6366F1"
                                                            Foreground="White"
                                                            FontSize="11"
                                                            FontWeight="SemiBold"
                                                            Padding="10,5"
                                                            Margin="0,0,6,0"
                                                            BorderThickness="0"
                                                            Cursor="Hand"
                                                            Command="{Binding DataContext.ViewInvoiceCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            CommandParameter="{Binding}">
                                                        <Button.Template>
                                                            <ControlTemplate TargetType="Button">
                                                                <Border Background="{TemplateBinding Background}"
                                                                        CornerRadius="6"
                                                                        Padding="{TemplateBinding Padding}">
                                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                                      VerticalAlignment="Center"/>
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Button.Template>
                                                    </Button>

                                                    <Button Content="🖨️ طباعة"
                                                            Background="#10B981"
                                                            Foreground="White"
                                                            FontSize="11"
                                                            FontWeight="SemiBold"
                                                            Padding="10,5"
                                                            BorderThickness="0"
                                                            Cursor="Hand"
                                                            Command="{Binding DataContext.PrintInvoiceCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            CommandParameter="{Binding}">
                                                        <Button.Template>
                                                            <ControlTemplate TargetType="Button">
                                                                <Border Background="{TemplateBinding Background}"
                                                                        CornerRadius="6"
                                                                        Padding="{TemplateBinding Padding}">
                                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                                      VerticalAlignment="Center"/>
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Button.Template>
                                                    </Button>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                                </DataGrid.Columns>
                            </DataGrid>

                            <!-- Empty State (auto show when count == 0) -->
                            <StackPanel VerticalAlignment="Center"
                                        HorizontalAlignment="Center"
                                        IsHitTestVisible="False">
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding InvoicesList.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>

                                <TextBlock Text="🔍" FontSize="56" HorizontalAlignment="Center" Opacity="0.25"/>
                                <TextBlock Text="لا توجد فواتير"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Foreground="#9CA3AF"
                                           HorizontalAlignment="Center"
                                           Margin="0,8,0,4"/>
                                <TextBlock Text="جرب تغيير معايير البحث أو الفلاتر"
                                           FontSize="13"
                                           Foreground="#CBD5E1"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>

                        </Grid>
                    </Grid>
                </Border>
            </Grid>

        </Grid>
    </ScrollViewer>
</UserControl>
