<UserControl x:Class="POS.CustomControl.SalesHistory_UserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:validations="clr-namespace:POS.Validations"
             mc:Ignorable="d"
             MinWidth="1366"
             MinHeight="768"
             FontFamily="{StaticResource Montserrat}"
             FlowDirection="RightToLeft">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Assets/UltraModernStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <validations:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <validations:IndexPlusOneConverter x:Key="IndexPlusOneConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource FadeInAnimation}"/>
        </EventTrigger>
    </UserControl.Triggers>

    <Grid Background="{StaticResource BackgroundGradientBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <Border Grid.Row="0" CornerRadius="20" Margin="20,20,20,16"
                RenderTransformOrigin="0.5,0.5">
            <Border.RenderTransform>
                <TranslateTransform x:Name="HeaderSlide"/>
            </Border.RenderTransform>
            <Border.Triggers>
                <EventTrigger RoutedEvent="Loaded">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetName="HeaderSlide" 
                                           Storyboard.TargetProperty="Y" 
                                           From="-80" To="0" Duration="0:0:0.7">
                                <DoubleAnimation.EasingFunction>
                                    <BackEase EasingMode="EaseOut" Amplitude="0.4"/>
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Border.Triggers>
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#7C3AED" Offset="0"/>
                    <GradientStop Color="#A855F7" Offset="0.5"/>
                    <GradientStop Color="#C026D3" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect Color="#7C3AED" BlurRadius="30" ShadowDepth="0" Opacity="0.4"/>
            </Border.Effect>

            <Grid Margin="24,18">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Width="60" Height="60" CornerRadius="15" 
                        Background="White" Margin="0,0,20,0">
                    <Border.Effect>
                        <DropShadowEffect Color="White" BlurRadius="20" ShadowDepth="0" Opacity="0.6"/>
                    </Border.Effect>
                    <Viewbox Margin="12">
                        <Path Fill="{StaticResource Primary600Brush}"
                              Data="M13 2L3 14h9l-.4 9 10-12h-9l.4-9z"/>
                    </Viewbox>
                </Border>

                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="سجل المبيعات" FontSize="28" FontWeight="Bold" 
                               Foreground="White" Margin="0,0,0,4"/>
                    <TextBlock Text="عرض وإدارة جميع الفواتير" FontSize="13" 
                               Foreground="White" Opacity="0.85"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Style="{StaticResource UltraModernGhostButton}"
                            Background="White"
                            Foreground="{StaticResource Accent600Brush}"
                            Command="{Binding ExportCommand}"
                            Height="50" Padding="20,0">
                        <StackPanel Orientation="Horizontal">
                            <Path Fill="{StaticResource Accent600Brush}" Width="20" Height="20" Margin="0,0,8,0"
                                  Data="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                            <TextBlock Text="تصدير" FontSize="14" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- STATS CARDS -->
        <Grid Grid.Row="1" Margin="20,0,20,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Total Invoices -->
            <Border Grid.Column="0" Style="{StaticResource UltraModernCard}" 
                    Margin="0,0,8,0" Padding="20,18"
                    RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <ScaleTransform x:Name="StCard1Scale" ScaleX="1" ScaleY="1"/>
                </Border.RenderTransform>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="StCard1Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1.03" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="StCard1Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1.03" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="StCard1Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="StCard1Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="إجمالي الفواتير" FontSize="12" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,0,6"/>
                        <TextBlock Text="{Binding TotalInvoices}" FontSize="32" FontWeight="ExtraBold">
                            <TextBlock.Foreground>
                                <SolidColorBrush Color="{StaticResource Accent900}"/>
                            </TextBlock.Foreground>
                        </TextBlock>
                    </StackPanel>
                    <Border Grid.Column="1" Width="55" Height="55" CornerRadius="14"
                            Background="#FCE7F3" VerticalAlignment="Center">
                        <Path Fill="{StaticResource Accent600Brush}" Width="28" Height="28"
                              Data="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                    </Border>
                </Grid>
            </Border>

            <!-- Total Sales -->
            <Border Grid.Column="1" Style="{StaticResource UltraModernCard}" 
                    Margin="8,0" Padding="20,18"
                    RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <ScaleTransform x:Name="StCard2Scale" ScaleX="1" ScaleY="1"/>
                </Border.RenderTransform>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="StCard2Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1.03" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="StCard2Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1.03" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="StCard2Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="StCard2Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="إجمالي المبيعات" FontSize="12" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,0,6"/>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding TotalSales, StringFormat={}{0:N0}}" FontSize="32" FontWeight="ExtraBold">
                                <TextBlock.Foreground>
                                    <SolidColorBrush Color="{StaticResource Success900}"/>
                                </TextBlock.Foreground>
                            </TextBlock>
                            <TextBlock Text="ج.م" FontSize="16" Foreground="{StaticResource TextSecondaryColor}" Margin="6,14,0,0"/>
                        </StackPanel>
                    </StackPanel>
                    <Border Grid.Column="1" Width="55" Height="55" CornerRadius="14"
                            Background="#D1FAE5" VerticalAlignment="Center">
                        <Path Fill="{StaticResource Success600Brush}" Width="28" Height="28"
                              Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"/>
                    </Border>
                </Grid>
            </Border>

            <!-- Average Invoice -->
            <Border Grid.Column="2" Style="{StaticResource UltraModernCard}" 
                    Margin="8,0" Padding="20,18"
                    RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <ScaleTransform x:Name="StCard3Scale" ScaleX="1" ScaleY="1"/>
                </Border.RenderTransform>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="StCard3Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1.03" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="StCard3Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1.03" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="StCard3Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="StCard3Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="متوسط الفاتورة" FontSize="12" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,0,6"/>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding AverageInvoice, StringFormat={}{0:N0}}" FontSize="32" FontWeight="ExtraBold">
                                <TextBlock.Foreground>
                                    <SolidColorBrush Color="{StaticResource Primary900}"/>
                                </TextBlock.Foreground>
                            </TextBlock>
                            <TextBlock Text="ج.م" FontSize="16" Foreground="{StaticResource TextSecondaryColor}" Margin="6,14,0,0"/>
                        </StackPanel>
                    </StackPanel>
                    <Border Grid.Column="1" Width="55" Height="55" CornerRadius="14"
                            Background="#EEF2FF" VerticalAlignment="Center">
                        <Path Fill="{StaticResource Primary600Brush}" Width="28" Height="28"
                              Data="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                    </Border>
                </Grid>
            </Border>

            <!-- Today Sales -->
            <Border Grid.Column="3" Style="{StaticResource UltraModernCard}" 
                    Margin="8,0,0,0" Padding="20,18"
                    RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <ScaleTransform x:Name="StCard4Scale" ScaleX="1" ScaleY="1"/>
                </Border.RenderTransform>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="StCard4Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1.03" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="StCard4Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1.03" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="StCard4Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="StCard4Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="مبيعات اليوم" FontSize="12" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,0,6"/>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding TodaySales, StringFormat={}{0:N0}}" FontSize="32" FontWeight="ExtraBold">
                                <TextBlock.Foreground>
                                    <SolidColorBrush Color="{StaticResource Warning900}"/>
                                </TextBlock.Foreground>
                            </TextBlock>
                            <TextBlock Text="ج.م" FontSize="16" Foreground="{StaticResource TextSecondaryColor}" Margin="6,14,0,0"/>
                        </StackPanel>
                    </StackPanel>
                    <Border Grid.Column="1" Width="55" Height="55" CornerRadius="14"
                            Background="#FEF3C7" VerticalAlignment="Center">
                        <Path Fill="{StaticResource Warning600Brush}" Width="28" Height="28"
                              Data="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- FILTERS & SEARCH -->
        <Border Grid.Row="2" Style="{StaticResource UltraModernCard}" Margin="20,0,20,16" Padding="20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1.5*"/>
                    <ColumnDefinition Width="1.2*"/>
                    <ColumnDefinition Width="1.2*"/>
                    <ColumnDefinition Width="1.2*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search -->
                <Border Grid.Column="0" CornerRadius="10" BorderBrush="{StaticResource Neutral300Brush}" 
                        BorderThickness="1.5" Background="White" Margin="0,0,12,0" Height="42">
                    <Grid>
                        <TextBlock Text="ادخل رقم الفاتورة" 
                                   FontSize="13"
                                   Foreground="{StaticResource TextSecondaryColor}"
                                   VerticalAlignment="Center"
                                   Margin="12,0,40,0"
                                   IsHitTestVisible="False"
                                   Opacity="0.6">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding InvoiceSearchQuery}" Value="">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding InvoiceSearchQuery}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <TextBox Text="{Binding InvoiceSearchQuery, UpdateSourceTrigger=PropertyChanged}"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 Padding="12,0,40,0"
                                 VerticalContentAlignment="Center"
                                 FontSize="13"
                                 Height="42"/>
                        <Path Fill="{StaticResource TextSecondaryColor}" Width="18" Height="18" 
                              HorizontalAlignment="Right" 
                              VerticalAlignment="Center"
                              Margin="0,0,12,0" 
                              Opacity="0.5"
                              Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </Grid>
                </Border>

                <!-- Date From -->
                <DatePicker Grid.Column="1"
                            SelectedDate="{Binding StartDate}"
                            Height="42"
                            FontSize="13"
                            VerticalContentAlignment="Center"
                            Padding="12,0"
                            Margin="0,0,12,0"
                            materialDesign:HintAssist.Hint="من تاريخ"
                            Style="{StaticResource MaterialDesignOutlinedDatePicker}"/>

                <!-- Date To -->
                <DatePicker Grid.Column="2"
                            SelectedDate="{Binding EndDate}"
                            Height="42"
                            FontSize="13"
                            VerticalContentAlignment="Center"
                            Padding="12,0"
                            Margin="0,0,12,0"
                            materialDesign:HintAssist.Hint="إلى تاريخ"
                            Style="{StaticResource MaterialDesignOutlinedDatePicker}"/>

                <!-- Payment Method -->
                <ComboBox Grid.Column="3"
                          ItemsSource="{Binding PaymentMethods}"
                          SelectedItem="{Binding SelectedPaymentMethod}"
                          Height="42"
                          FontSize="13"
                          VerticalContentAlignment="Center"
                          Padding="12,0"
                          Margin="0,0,12,0"
                          materialDesign:HintAssist.Hint="طريقة الدفع"
                          Style="{StaticResource MaterialDesignOutlinedComboBox}"/>

                <!-- Actions -->
                <StackPanel Grid.Column="4" Orientation="Horizontal">
                    <Button Style="{StaticResource UltraModernPrimaryButton}"
                            Command="{Binding SearchCommand}"
                            Height="42" Width="42" Padding="0" Margin="0,0,8,0">
                        <Path Fill="White" Width="18" Height="18"
                              Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </Button>
                    <Button Style="{StaticResource UltraModernGhostButton}"
                            Command="{Binding ClearFiltersCommand}"
                            Height="42" Width="42" Padding="0">
                        <Path Fill="{StaticResource Danger600Brush}" Width="18" Height="18"
                              Data="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- INVOICES DATAGRID -->
        <Border Grid.Row="3" Style="{StaticResource UltraModernCard}" Margin="20,0,20,16">
            <DataGrid ItemsSource="{Binding InvoicesList}"
                      SelectedItem="{Binding SelectedInvoice}"
                      Style="{StaticResource UltraModernDataGrid}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      VirtualizingPanel.IsVirtualizing="True"
                      VirtualizingPanel.VirtualizationMode="Recycling">
                
                <DataGrid.Columns>
                    <DataGridTextColumn Header="#" Width="50" Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Converter={StaticResource IndexPlusOneConverter}}"/>
                    
                    <!-- Invoice Number -->
                    <DataGridTemplateColumn Header="رقم الفاتورة" Width="1.2*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="8,4">
                                    <Border Width="36" Height="36" CornerRadius="8" Margin="0,0,10,0"
                                            Background="{StaticResource Primary600Brush}">
                                        <Path Fill="White" Width="18" Height="18"
                                              Data="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                                    </Border>
                                    <TextBlock Text="{Binding Number}" FontWeight="SemiBold" FontSize="13" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Customer -->
                    <DataGridTextColumn Header="العميل" Width="1.5*" Binding="{Binding Customer.Name}"/>

                    <!-- Date -->
                    <DataGridTextColumn Header="التاريخ" Width="1.2*" Binding="{Binding Date, StringFormat=dd/MM/yyyy}"/>

                    <!-- Total -->
                    <DataGridTemplateColumn Header="الإجمالي" Width="1.2*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding TotalPrice, StringFormat={}{0:N2}}" FontWeight="Bold" FontSize="13">
                                        <TextBlock.Foreground>
                                            <SolidColorBrush Color="{StaticResource Success900}"/>
                                        </TextBlock.Foreground>
                                    </TextBlock>
                                    <TextBlock Text="ج.م" FontSize="11" Foreground="{StaticResource TextSecondaryColor}" Margin="4,0,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Payment Method -->
                    <DataGridTemplateColumn Header="الدفع" Width="1*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="8" Padding="10,6" HorizontalAlignment="Center">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="#E0E7FF"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding PaymentMethod}" Value="كاش">
                                                    <Setter Property="Background" Value="#D1FAE5"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="{Binding PaymentMethod}" FontWeight="SemiBold" FontSize="12">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground">
                                                    <Setter.Value>
                                                        <SolidColorBrush Color="{StaticResource Primary900}"/>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding PaymentMethod}" Value="كاش">
                                                        <Setter Property="Foreground">
                                                            <Setter.Value>
                                                                <SolidColorBrush Color="{StaticResource Success900}"/>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Cashier -->
                    <DataGridTextColumn Header="الكاشير" Width="1.2*" Binding="{Binding CashierName}"/>

                    <!-- Actions -->
                    <DataGridTemplateColumn Header="الإجراءات" Width="1.5*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Style="{StaticResource UltraModernGhostButton}"
                                            Command="{Binding DataContext.ViewCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Width="40" Height="40" Padding="0" Margin="5,0"
                                            ToolTip="عرض التفاصيل">
                                        <Path Fill="{StaticResource Primary600Brush}" Width="20" Height="20"
                                              Data="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                    </Button>
                                    <Button Style="{StaticResource UltraModernGhostButton}"
                                            Command="{Binding DataContext.PrintCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Width="40" Height="40" Padding="0" Margin="5,0"
                                            ToolTip="طباعة">
                                        <Path Fill="{StaticResource Success600Brush}" Width="20" Height="20"
                                              Data="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                                    </Button>
                                    <Button Style="{StaticResource UltraModernGhostButton}"
                                            Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Width="40" Height="40" Padding="0" Margin="5,0"
                                            ToolTip="حذف">
                                        <Path Fill="{StaticResource Danger600Brush}" Width="20" Height="20"
                                              Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- FOOTER -->
        <Border Grid.Row="4" Margin="20,0,20,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="إجمالي النتائج:" FontSize="13" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding TotalInvoices}" FontSize="13" FontWeight="Bold" Foreground="{StaticResource TextPrimaryColor}"/>
                </StackPanel>

                <Button Grid.Column="1"
                        Style="{StaticResource UltraModernPrimaryButton}"
                        Command="{Binding RefreshCommand}"
                        Height="48" Padding="20,0">
                    <StackPanel Orientation="Horizontal">
                        <Path Fill="White" Width="20" Height="20" Margin="0,0,8,0"
                              Data="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                        <TextBlock Text="تحديث" FontSize="14" FontWeight="SemiBold"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>
    </Grid>
</UserControl>
