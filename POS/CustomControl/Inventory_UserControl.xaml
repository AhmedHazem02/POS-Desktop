<UserControl x:Class="POS.CustomControl.Inventory_UserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:validations="clr-namespace:POS.Validations"
             mc:Ignorable="d"
             MinWidth="1366"
             MinHeight="768"
             FontFamily="{StaticResource Montserrat}"
             FlowDirection="RightToLeft">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Assets/UltraModernStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <validations:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <validations:IndexPlusOneConverter x:Key="IndexPlusOneConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource FadeInAnimation}"/>
        </EventTrigger>
    </UserControl.Triggers>

    <!-- ══════════════════════════════════════════════════════════════ -->
    <!--                    ULTRA MODERN INVENTORY LAYOUT               -->
    <!-- ══════════════════════════════════════════════════════════════ -->
    <Grid Background="{StaticResource BackgroundGradientBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="Auto"/> <!-- Stats Cards -->
            <RowDefinition Height="Auto"/> <!-- Filters & Search -->
            <RowDefinition Height="*"/>    <!-- Products Grid -->
            <RowDefinition Height="Auto"/> <!-- Actions Footer -->
        </Grid.RowDefinitions>

        <!-- ═══════════════ ANIMATED HEADER ═══════════════ -->
        <Border Grid.Row="0" CornerRadius="20" Margin="20,20,20,16"
                RenderTransformOrigin="0.5,0.5">
            <Border.RenderTransform>
                <TranslateTransform x:Name="HeaderSlide"/>
            </Border.RenderTransform>
            <Border.Triggers>
                <EventTrigger RoutedEvent="Loaded">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetName="HeaderSlide" 
                                           Storyboard.TargetProperty="Y" 
                                           From="-80" To="0" Duration="0:0:0.7">
                                <DoubleAnimation.EasingFunction>
                                    <BackEase EasingMode="EaseOut" Amplitude="0.4"/>
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Border.Triggers>
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#1E40AF" Offset="0"/>
                    <GradientStop Color="#3B82F6" Offset="0.5"/>
                    <GradientStop Color="#0EA5E9" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect Color="#1E40AF" BlurRadius="30" ShadowDepth="0" Opacity="0.4"/>
            </Border.Effect>

            <Grid Margin="24,18">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Icon -->
                <Border Grid.Column="0" Width="60" Height="60" CornerRadius="15" 
                        Background="White" Margin="0,0,20,0">
                    <Border.Effect>
                        <DropShadowEffect Color="White" BlurRadius="20" ShadowDepth="0" Opacity="0.6"/>
                    </Border.Effect>
                    <Viewbox Margin="12">
                        <Path Fill="{StaticResource PrimaryGradientBrush}"
                              Data="M20 2H4c-1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 14H6v-2h2v2zm0-3H6V9h2v2zm0-3H6V6h2v2zm7 6h-5v-2h5v2zm3-3h-8V9h8v2zm0-3h-8V6h8v2z"/>
                    </Viewbox>
                </Border>

                <!-- Title -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="إدارة المخزون" FontSize="28" FontWeight="Bold" 
                               Foreground="White" Margin="0,0,0,4"/>
                    <TextBlock Text="المنتجات والمخزون" FontSize="13" 
                               Foreground="White" Opacity="0.85"/>
                </StackPanel>

                <!-- Quick Actions -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Style="{StaticResource UltraModernGhostButton}"
                            Background="White"
                            Foreground="{StaticResource Primary600Brush}"
                            Command="{Binding AddProductCommand}"
                            Height="50" Padding="20,0"
                            Margin="0,0,12,0">
                        <StackPanel Orientation="Horizontal">
                            <Path Fill="{StaticResource Primary600Brush}" Width="20" Height="20" Margin="0,0,8,0"
                                  Data="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            <TextBlock Text="إضافة منتج" FontSize="14" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ═══════════════ STAT CARDS ═══════════════ -->
        <Grid Grid.Row="1" Margin="20,0,20,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Total Products Card -->
            <Border Grid.Column="0" Style="{StaticResource UltraModernCard}" 
                    Margin="0,0,8,0" Padding="20,18"
                    RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <ScaleTransform x:Name="Card1Scale" ScaleX="1" ScaleY="1"/>
                </Border.RenderTransform>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="Card1Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1.03" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="Card1Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1.03" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="Card1Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="Card1Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="إجمالي المنتجات" FontSize="12" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,0,6"/>
                        <TextBlock Text="{Binding TotalProducts}" FontSize="32" FontWeight="ExtraBold">
                            <TextBlock.Foreground>
                                <SolidColorBrush Color="{StaticResource Primary900}"/>
                            </TextBlock.Foreground>
                        </TextBlock>
                    </StackPanel>
                    <Border Grid.Column="1" Width="55" Height="55" CornerRadius="14"
                            Background="#EEF2FF" VerticalAlignment="Center">
                        <Path Fill="{StaticResource Primary600Brush}" Width="28" Height="28"
                              Data="M20 2H4c-1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                    </Border>
                </Grid>
            </Border>

            <!-- Low Stock Card -->
            <Border Grid.Column="1" Style="{StaticResource UltraModernCard}" 
                    Margin="8,0" Padding="20,18"
                    RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <ScaleTransform x:Name="Card2Scale" ScaleX="1" ScaleY="1"/>
                </Border.RenderTransform>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="Card2Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1.03" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="Card2Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1.03" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="Card2Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="Card2Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="منتجات منخفضة المخزون" FontSize="12" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,0,6"/>
                        <TextBlock Text="{Binding LowStockCount}" FontSize="32" FontWeight="ExtraBold">
                            <TextBlock.Foreground>
                                <SolidColorBrush Color="{StaticResource Warning900}"/>
                            </TextBlock.Foreground>
                        </TextBlock>
                    </StackPanel>
                    <Border Grid.Column="1" Width="55" Height="55" CornerRadius="14"
                            Background="#FEF3C7" VerticalAlignment="Center">
                        <Path Fill="{StaticResource Warning600Brush}" Width="28" Height="28"
                              Data="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                    </Border>
                </Grid>
            </Border>

            <!-- Total Value Card -->
            <Border Grid.Column="2" Style="{StaticResource UltraModernCard}" 
                    Margin="8,0" Padding="20,18"
                    RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <ScaleTransform x:Name="Card3Scale" ScaleX="1" ScaleY="1"/>
                </Border.RenderTransform>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="Card3Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1.03" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="Card3Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1.03" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="Card3Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="Card3Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="قيمة المخزون" FontSize="12" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,0,6"/>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding TotalInventoryValue, StringFormat={}{0:N0}}" FontSize="32" FontWeight="ExtraBold">
                                <TextBlock.Foreground>
                                    <SolidColorBrush Color="{StaticResource Success900}"/>
                                </TextBlock.Foreground>
                            </TextBlock>
                            <TextBlock Text="ج.م" FontSize="16" Foreground="{StaticResource TextSecondaryColor}" Margin="6,14,0,0"/>
                        </StackPanel>
                    </StackPanel>
                    <Border Grid.Column="1" Width="55" Height="55" CornerRadius="14"
                            Background="#D1FAE5" VerticalAlignment="Center">
                        <Path Fill="{StaticResource Success600Brush}" Width="28" Height="28"
                              Data="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                    </Border>
                </Grid>
            </Border>

            <!-- Categories Card -->
            <Border Grid.Column="3" Style="{StaticResource UltraModernCard}" 
                    Margin="8,0,0,0" Padding="20,18"
                    RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <ScaleTransform x:Name="Card4Scale" ScaleX="1" ScaleY="1"/>
                </Border.RenderTransform>
                <Border.Triggers>
                    <EventTrigger RoutedEvent="MouseEnter">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="Card4Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1.03" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="Card4Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1.03" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                    <EventTrigger RoutedEvent="MouseLeave">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="Card4Scale" 
                                               Storyboard.TargetProperty="ScaleX" 
                                               To="1" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetName="Card4Scale" 
                                               Storyboard.TargetProperty="ScaleY" 
                                               To="1" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="الأصناف" FontSize="12" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,0,6"/>
                        <TextBlock Text="{Binding TotalCategories}" FontSize="32" FontWeight="ExtraBold">
                            <TextBlock.Foreground>
                                <SolidColorBrush Color="{StaticResource Accent900}"/>
                            </TextBlock.Foreground>
                        </TextBlock>
                    </StackPanel>
                    <Border Grid.Column="1" Width="55" Height="55" CornerRadius="14"
                            Background="#FCE7F3" VerticalAlignment="Center">
                        <Path Fill="{StaticResource Accent600Brush}" Width="28" Height="28"
                              Data="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- ═══════════════ FILTERS & SEARCH ═══════════════ -->
        <Border Grid.Row="2" Style="{StaticResource UltraModernCard}" Margin="20,0,20,16" Padding="20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="1.5*"/>
                    <ColumnDefinition Width="1.5*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search Box -->
                <Border Grid.Column="0" CornerRadius="12" BorderBrush="{StaticResource Neutral300Brush}" 
                        BorderThickness="1.5" Background="White" Margin="0,0,12,0">
                    <Grid>
                        <Path Fill="{StaticResource TextSecondaryColor}" Width="20" Height="20" 
                              HorizontalAlignment="Right" Margin="14,0" Opacity="0.5"
                              Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        <TextBox Style="{StaticResource UltraModernTextBox}"
                                 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 Padding="14,12,44,12"
                                 FontSize="14"
                                 materialDesign:HintAssist.Hint="ابحث عن منتج..." />
                    </Grid>
                </Border>

                <!-- Category Filter -->
                <ComboBox Grid.Column="1" 
                          ItemsSource="{Binding Categories}"
                          SelectedItem="{Binding SelectedCategory}"
                          DisplayMemberPath="Name"
                          Height="48"
                          FontSize="14"
                          Margin="0,0,12,0"
                          materialDesign:HintAssist.Hint="التصنيف"
                          Style="{StaticResource MaterialDesignOutlinedComboBox}"/>

                <!-- Warehouse Filter -->
                <ComboBox Grid.Column="2" 
                          ItemsSource="{Binding Warehouses}"
                          SelectedItem="{Binding SelectedWarehouse}"
                          DisplayMemberPath="Name"
                          Height="48"
                          FontSize="14"
                          Margin="0,0,12,0"
                          materialDesign:HintAssist.Hint="المستودع"
                          Style="{StaticResource MaterialDesignOutlinedComboBox}"/>

                <!-- Filter Actions -->
                <StackPanel Grid.Column="3" Orientation="Horizontal">
                    <Button Style="{StaticResource UltraModernGhostButton}"
                            Command="{Binding FilterCommand}"
                            Height="48" Width="48" Padding="0" Margin="0,0,8,0">
                        <Path Fill="{StaticResource Primary600Brush}" Width="22" Height="22"
                              Data="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                    </Button>
                    <Button Style="{StaticResource UltraModernGhostButton}"
                            Command="{Binding ClearFiltersCommand}"
                            Height="48" Width="48" Padding="0">
                        <Path Fill="{StaticResource Danger600Brush}" Width="22" Height="22"
                              Data="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ═══════════════ PRODUCTS DATAGRID ═══════════════ -->
        <Border Grid.Row="3" Style="{StaticResource UltraModernCard}" Margin="20,0,20,16">
            <DataGrid ItemsSource="{Binding ProductsList}"
                      SelectedItem="{Binding SelectedProduct}"
                      Style="{StaticResource UltraModernDataGrid}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      VirtualizingPanel.IsVirtualizing="True"
                      VirtualizingPanel.VirtualizationMode="Recycling"
                      EnableRowVirtualization="True"
                      EnableColumnVirtualization="True">
                
                <DataGrid.Columns>
                    <!-- Row Number -->
                    <DataGridTextColumn Header="#" Width="50" Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Converter={StaticResource IndexPlusOneConverter}}"/>
                    
                    <!-- Product Name -->
                    <DataGridTemplateColumn Header="المنتج" Width="2*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="8,4">
                                    <Border Width="40" Height="40" CornerRadius="8" Margin="0,0,12,0"
                                            Background="{StaticResource PrimaryGradientBrush}">
                                        <TextBlock Text="{Binding Name, Converter={StaticResource InitialsConverter}}"
                                                   Foreground="White"
                                                   FontSize="14"
                                                   FontWeight="Bold"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="13"/>
                                        <TextBlock Text="{Binding Barcode}" FontSize="11" Foreground="{StaticResource TextSecondaryColor}" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Category -->
                    <DataGridTextColumn Header="التصنيف" Width="1.2*" Binding="{Binding Category.Name}"/>

                    <!-- Quantity -->
                    <DataGridTemplateColumn Header="الكمية" Width="1*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Background="#EEF2FF" CornerRadius="8" Padding="10,6" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding TotalQuantity, StringFormat={}{0:0.##}}" 
                                               FontWeight="Bold" FontSize="13">
                                        <TextBlock.Foreground>
                                            <SolidColorBrush Color="{StaticResource Primary900}"/>
                                        </TextBlock.Foreground>
                                    </TextBlock>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Purchase Price -->
                    <DataGridTemplateColumn Header="سعر الشراء" Width="1*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding PurchasePrice, StringFormat={}{0:N2}}" FontWeight="SemiBold" FontSize="13"/>
                                    <TextBlock Text="ج.م" FontSize="11" Foreground="{StaticResource TextSecondaryColor}" Margin="4,0,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Sale Price -->
                    <DataGridTemplateColumn Header="سعر البيع" Width="1*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding SalePrice, StringFormat={}{0:N2}}" FontWeight="SemiBold" FontSize="13">
                                        <TextBlock.Foreground>
                                            <SolidColorBrush Color="{StaticResource Success900}"/>
                                        </TextBlock.Foreground>
                                    </TextBlock>
                                    <TextBlock Text="ج.م" FontSize="11" Foreground="{StaticResource TextSecondaryColor}" Margin="4,0,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Status -->
                    <DataGridTemplateColumn Header="الحالة" Width="1*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="8" Padding="12,6" HorizontalAlignment="Center">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="#D1FAE5"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsLowStock}" Value="True">
                                                    <Setter Property="Background" Value="#FEE2E2"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock FontWeight="SemiBold" FontSize="12">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="متوفر"/>
                                                <Setter Property="Foreground">
                                                    <Setter.Value>
                                                        <SolidColorBrush Color="{StaticResource Success900}"/>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsLowStock}" Value="True">
                                                        <Setter Property="Text" Value="منخفض"/>
                                                        <Setter Property="Foreground">
                                                            <Setter.Value>
                                                                <SolidColorBrush Color="{StaticResource Danger900}"/>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Actions -->
                    <DataGridTemplateColumn Header="الإجراءات" Width="1.2*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Style="{StaticResource UltraModernGhostButton}"
                                            Command="{Binding DataContext.EditProductCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Width="36" Height="36" Padding="0" Margin="4,0">
                                        <Path Fill="{StaticResource Primary600Brush}" Width="18" Height="18"
                                              Data="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                    </Button>
                                    <Button Style="{StaticResource UltraModernGhostButton}"
                                            Command="{Binding DataContext.DeleteProductCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Width="36" Height="36" Padding="0" Margin="4,0">
                                        <Path Fill="{StaticResource Danger600Brush}" Width="18" Height="18"
                                              Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- ═══════════════ ACTIONS FOOTER ═══════════════ -->
        <Border Grid.Row="4" Margin="20,0,20,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Pagination Info -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="إجمالي المنتجات:" FontSize="13" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding TotalProducts}" FontSize="13" FontWeight="Bold" Foreground="{StaticResource TextPrimaryColor}"/>
                </StackPanel>

                <!-- Export & Refresh Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Style="{StaticResource UltraModernGhostButton}"
                            Command="{Binding ExportToExcelCommand}"
                            Height="48" Padding="20,0" Margin="0,0,12,0">
                        <StackPanel Orientation="Horizontal">
                            <Path Fill="{StaticResource Success600Brush}" Width="20" Height="20" Margin="0,0,8,0"
                                  Data="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                            <TextBlock Text="تصدير Excel" FontSize="14" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource UltraModernPrimaryButton}"
                            Command="{Binding RefreshCommand}"
                            Height="48" Padding="20,0">
                        <StackPanel Orientation="Horizontal">
                            <Path Fill="White" Width="20" Height="20" Margin="0,0,8,0"
                                  Data="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                            <TextBlock Text="تحديث" FontSize="14" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
