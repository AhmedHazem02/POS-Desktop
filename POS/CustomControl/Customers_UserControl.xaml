<UserControl x:Class="POS.CustomControl.Customers_UserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:validations="clr-namespace:POS.Validations"
             mc:Ignorable="d"
             MinWidth="900"
             MinHeight="700"
             FontFamily="Segoe UI"
             FlowDirection="RightToLeft">
    <UserControl.Resources>
        <validations:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <validations:BalanceToBrushConverter x:Key="CustomerBalanceBrushConverter"
                                             PositiveBrush="#16A34A"
                                             NegativeBrush="#DC2626"
                                             NeutralBrush="#F59E0B"/>

        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="14"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#E2E8F0" BlurRadius="12" ShadowDepth="1" Opacity="0.4"/>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid Background="{StaticResource PrimaryBackgroundColor}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Margin="10,10,10,12" CornerRadius="16">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#1E40AF" Offset="0"/>
                    <GradientStop Color="#0EA5E9" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid Margin="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <TextBlock Text="العملاء"
                               FontFamily="{StaticResource Montserrat_Bold}"
                               FontSize="26"
                               Foreground="White"/>
                    <TextBlock Text="عرض سريع لأهم بيانات العملاء وإدارتهم."
                               FontSize="13"
                               Foreground="#E2E8F0"
                               Margin="0,6,0,0"/>
                </StackPanel>
                <Button Grid.Column="1"
                        Content="إضافة عميل"
                        Padding="18,8"
                        Margin="0,0,0,0"
                        Background="#F97316"
                        Foreground="White"
                        FontWeight="Bold"
                        Style="{StaticResource CustomButtonStyle}"
                        Click="AddCustomer_Click"/>
            </Grid>
        </Border>

        <!-- Filters + Stats -->
        <Border Grid.Row="1" Style="{StaticResource CardStyle}" Margin="10,0,10,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                    <TextBlock Text="ابحث بالاسم أو الهاتف" FontSize="12" Foreground="#64748B"/>
                    <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource ModernTextBoxStyle}"
                             Height="34"
                             Margin="0,6,0,0"/>
                </StackPanel>

                <Border Grid.Column="1" CornerRadius="12" Background="#F1F5F9" Padding="12" Margin="0,0,12,0">
                    <StackPanel>
                        <TextBlock Text="إجمالي العملاء" FontSize="12" Foreground="#64748B"/>
                        <TextBlock Text="{Binding ItemList.Count}" FontSize="20" FontWeight="Bold" Foreground="#0F172A"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="2" CornerRadius="12" Background="#ECFEFF" Padding="12">
                    <StackPanel>
                        <TextBlock Text="نتائج البحث" FontSize="12" Foreground="#0E7490"/>
                        <TextBlock Text="{Binding ItemList.Count}" FontSize="20" FontWeight="Bold" Foreground="#0E7490"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- List -->
        <Border Grid.Row="2" Style="{StaticResource CardStyle}" Margin="10,0,10,10" Padding="0">
            <DataGrid ItemsSource="{Binding ItemList}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      SelectionMode="Single"
                      HeadersVisibility="Column"
                      RowHeight="34"
                      FontSize="12"
                      GridLinesVisibility="Horizontal"
                      EnableRowVirtualization="True"
                      EnableColumnVirtualization="True"
                      VirtualizingPanel.IsVirtualizing="True"
                      VirtualizingPanel.VirtualizationMode="Recycling"
                      ScrollViewer.IsDeferredScrollingEnabled="True"
                      ScrollViewer.CanContentScroll="True">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="الاسم" Binding="{Binding Name}" Width="2*"/>
                    <DataGridTextColumn Header="الهاتف" Binding="{Binding Phone}" Width="1.3*"/>
                    <DataGridTextColumn Header="البريد الإلكتروني" Binding="{Binding Email}" Width="2*"/>
                    <DataGridTextColumn Header="المدينة" Binding="{Binding City}" Width="1.2*"/>
                    <DataGridTextColumn Header="الرصيد الحالي"
                                        Binding="{Binding CurrentBalance, StringFormat={}{0:N2}}"
                                        Width="1.1*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground"
                                        Value="{Binding CurrentBalance, Converter={StaticResource CustomerBalanceBrushConverter}}"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTemplateColumn Header="افتراضي" Width="0.9*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Background="#DCFCE7" CornerRadius="12" Padding="6,2"
                                        Visibility="{Binding IsDefault, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock Text="افتراضي" FontSize="11" Foreground="#166534" FontWeight="SemiBold"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</UserControl>
