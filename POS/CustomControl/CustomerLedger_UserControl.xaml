<UserControl x:Class="POS.CustomControl.CustomerLedger_UserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:validations="clr-namespace:POS.Validations"
             mc:Ignorable="d"
             MinWidth="900"
             MinHeight="700"
             FontFamily="Segoe UI"
             FlowDirection="RightToLeft"
             UseLayoutRounding="True"
             SnapsToDevicePixels="True">
    <UserControl.Resources>
        <validations:DoubleTextConverter x:Key="DoubleTextConverter" />

        <Style x:Key="LedgerCard" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#E5E7EB" BlurRadius="12" ShadowDepth="1" Opacity="0.35"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#475569"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>
    </UserControl.Resources>

    <Border FlowDirection="RightToLeft"
            Margin="10"
            CornerRadius="16"
            Background="#F8FAFC"
            BorderThickness="1"
            BorderBrush="#E2E8F0"
            Padding="16">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="4,0,4,12">
                <TextBlock Text="كشف حساب العميل" FontSize="22" FontWeight="Bold" Foreground="#0F172A"/>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="الرصيد الحالي:" FontSize="13" Foreground="#64748B" Margin="0,0,6,0"/>
                    <TextBlock FontSize="16" FontWeight="Bold" Foreground="#0F172A">
                        <Run Text="{Binding CurrentBalance, StringFormat={}{0:N2}}"/>
                        <Run Text=" جنيه"/>
                    </TextBlock>
                </StackPanel>
            </StackPanel>

            <!-- Filters -->
            <Border Grid.Row="1" Style="{StaticResource LedgerCard}" Margin="0,0,0,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,12,0">
                        <TextBlock Text="العميل" Style="{StaticResource FieldLabel}"/>
                        <ComboBox ItemsSource="{Binding Customers}"
                                  SelectedItem="{Binding SelectedCustomer}"
                                  DisplayMemberPath="Name"
                                  Height="34"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="0,0,12,0">
                        <TextBlock Text="من تاريخ" Style="{StaticResource FieldLabel}"/>
                        <DatePicker SelectedDate="{Binding StartDate}" Height="34"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Margin="0,0,12,0">
                        <TextBlock Text="إلى تاريخ" Style="{StaticResource FieldLabel}"/>
                        <DatePicker SelectedDate="{Binding EndDate}" Height="34"/>
                    </StackPanel>

                    <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Bottom">
                        <Button Content="بحث"
                                Margin="0,0,8,0"
                                Padding="16,6"
                                Style="{StaticResource CustomButtonStyle}"
                                Background="#2563EB"
                                Foreground="White"
                                Command="{Binding RefreshCommand}"/>
                        <Button Content="مسح"
                                Padding="16,6"
                                Style="{StaticResource CustomButtonStyle}"
                                Background="#E11D48"
                                Foreground="White"
                                Command="{Binding ClearFiltersCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Payment -->
            <Border Grid.Row="2" Style="{StaticResource LedgerCard}" Margin="0,0,0,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,12,0">
                        <TextBlock Text="مبلغ التحصيل" Style="{StaticResource FieldLabel}"/>
                        <TextBox Text="{Binding PaymentAmount, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay, Converter={StaticResource DoubleTextConverter}}"
                                 Style="{StaticResource ModernTextBoxStyle}"
                                 Height="34"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="0,0,12,0">
                        <TextBlock Text="طريقة الدفع" Style="{StaticResource FieldLabel}"/>
                        <ComboBox ItemsSource="{Binding PaymentMethods}"
                                  SelectedItem="{Binding SelectedPaymentMethod}"
                                  Height="34"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Margin="0,0,12,0">
                        <TextBlock Text="مرجع الدفع" Style="{StaticResource FieldLabel}"/>
                        <TextBox Text="{Binding PaymentReference, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource ModernTextBoxStyle}"
                                 Height="34"/>
                    </StackPanel>

                    <Button Grid.Column="3"
                            Content="تسجيل التحصيل"
                            Style="{StaticResource CustomButtonStyle}"
                            Background="#16A34A"
                            Foreground="White"
                            Padding="18,8"
                            Command="{Binding RecordPaymentCommand}"
                            Margin="0,18,0,0"/>
                </Grid>
            </Border>

            <!-- Statement Table -->
            <Border Grid.Row="3" Style="{StaticResource LedgerCard}" Padding="0">
                <DataGrid ItemsSource="{Binding LedgerEntries}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          SelectionMode="Single"
                          HeadersVisibility="Column"
                          RowHeight="34"
                          FontSize="12"
                          GridLinesVisibility="Horizontal">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="التاريخ"
                                            Binding="{Binding Date, StringFormat='{}{0:yyyy/MM/dd}'}"
                                            Width="120"/>
                        <DataGridTextColumn Header="الوصف"
                                            Binding="{Binding Description}"
                                            Width="*"/>
                        <DataGridTextColumn Header="المرجع"
                                            Binding="{Binding ReferenceNumber}"
                                            Width="140"/>
                        <DataGridTextColumn Header="مدين"
                                            Binding="{Binding Debit, StringFormat={}{0:N2}}"
                                            Width="120"/>
                        <DataGridTextColumn Header="دائن"
                                            Binding="{Binding Credit, StringFormat={}{0:N2}}"
                                            Width="120"/>
                        <DataGridTextColumn Header="الرصيد"
                                            Binding="{Binding RunningBalance, StringFormat={}{0:N2}}"
                                            Width="140"/>
                        <DataGridTextColumn Header="طريقة الدفع"
                                            Binding="{Binding PaymentMethod}"
                                            Width="130"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>
        </Grid>
    </Border>
</UserControl>
