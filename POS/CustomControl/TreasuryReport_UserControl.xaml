<UserControl x:Class="POS.CustomControl.TreasuryReport_UserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:validations="clr-namespace:POS.Validations"
             mc:Ignorable="d"
             MinWidth="900"
             MinHeight="700"
             FontFamily="Segoe UI"
             FlowDirection="RightToLeft"
             UseLayoutRounding="True"
             SnapsToDevicePixels="True">

    <UserControl.Resources>
        <validations:TransactionTypeToArabicConverter x:Key="TransactionTypeToArabicConverter" />
        <Style x:Key="ReportCard" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#E5E7EB" BlurRadius="12" ShadowDepth="1" Opacity="0.35"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#475569"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>

        <Style x:Key="CompactInput" TargetType="Control">
            <Setter Property="Height" Value="34"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>
    </UserControl.Resources>

    <Border FlowDirection="RightToLeft"
            Margin="10"
            CornerRadius="16"
            Background="#F8FAFC"
            BorderThickness="1"
            BorderBrush="#E2E8F0"
            Padding="16">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="4,0,4,12">
                <TextBlock Text="تقرير الخزينة" FontSize="22" FontWeight="Bold" Foreground="#0F172A"/>
                <TextBlock Text="ملخص حركة الوارد والصادر خلال الفترة المحددة"
                           FontSize="12"
                           Foreground="#64748B"
                           Margin="0,4,0,0"/>
            </StackPanel>

            <!-- Filters -->
            <Border Grid.Row="1" Style="{StaticResource ReportCard}" Margin="0,0,0,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,12,0">
                        <TextBlock Text="نوع الحركة" Style="{StaticResource FieldLabel}"/>
                        <ComboBox ItemsSource="{Binding TransactionTypes}"
                                  SelectedItem="{Binding SelectedTransactionType}"
                                  Style="{StaticResource CompactInput}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="0,0,12,0">
                        <TextBlock Text="من تاريخ" Style="{StaticResource FieldLabel}"/>
                        <DatePicker SelectedDate="{Binding StartDate}"
                                    Style="{StaticResource CompactInput}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Margin="0,0,12,0">
                        <TextBlock Text="إلى تاريخ" Style="{StaticResource FieldLabel}"/>
                        <DatePicker SelectedDate="{Binding EndDate}"
                                    Style="{StaticResource CompactInput}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Bottom">
                        <Button Content="بحث"
                                Margin="0,0,8,0"
                                Padding="18,6"
                                Background="#2563EB"
                                Foreground="White"
                                BorderThickness="0"
                                Command="{Binding RefreshCommand}"/>
                        <Button Content="مسح"
                                Padding="18,6"
                                Background="#E11D48"
                                Foreground="White"
                                BorderThickness="0"
                                Command="{Binding ClearFiltersCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Summary -->
            <UniformGrid Grid.Row="2" Columns="3" Margin="0,0,0,12">
                <Border Style="{StaticResource ReportCard}" Margin="0,0,8,0">
                    <StackPanel>
                        <TextBlock Text="إجمالي الوارد" FontSize="12" Foreground="#64748B"/>
                        <TextBlock Text="{Binding TotalIncome, StringFormat={}{0:N2} جنيه}"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="#16A34A"
                                   Margin="0,6,0,0"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource ReportCard}" Margin="0,0,8,0">
                    <StackPanel>
                        <TextBlock Text="إجمالي الصادر" FontSize="12" Foreground="#64748B"/>
                        <TextBlock Text="{Binding TotalOutcome, StringFormat={}{0:N2} جنيه}"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="#DC2626"
                                   Margin="0,6,0,0"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource ReportCard}">
                    <StackPanel>
                        <TextBlock Text="صافي الحركة" FontSize="12" Foreground="#64748B"/>
                        <TextBlock Text="{Binding NetBalance, StringFormat={}{0:N2} جنيه}"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="#0F172A"
                                   Margin="0,6,0,0"/>
                    </StackPanel>
                </Border>
            </UniformGrid>

            <!-- Table -->
            <Border Grid.Row="3" Style="{StaticResource ReportCard}" Padding="0">
                <DataGrid ItemsSource="{Binding CashEntries}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          HeadersVisibility="Column"
                          RowHeight="34"
                          FontSize="12"
                          Background="White"
                          GridLinesVisibility="Horizontal">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="التاريخ"
                                            Binding="{Binding CreatedDate, StringFormat='{}{0:yyyy/MM/dd}'}"
                                            Width="120"/>
                        <DataGridTextColumn Header="الوصف"
                                            Binding="{Binding CashName}"
                                            Width="2*"/>
                        <DataGridTemplateColumn Header="النوع" Width="110">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Type, Converter={StaticResource TransactionTypeToArabicConverter}}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="المبلغ"
                                            Binding="{Binding Amount, StringFormat={}{0:N2}}"
                                            Width="120"/>
                        <DataGridTextColumn Header="العملة"
                                            Binding="{Binding Currency}"
                                            Width="80"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>
        </Grid>
    </Border>
</UserControl>
